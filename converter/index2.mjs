import{$1,$clamp}from"/util.mjs";import{initialize,deduceFormats,formats,getDecodableFormats,getEncodableFormats}from"./formats.mjs";let initialization=(async()=>{await initialize();const[e,t]=await Promise.all([getDecodableFormats(),getEncodableFormats()]),a=$1(".src-formats-header"),i=$1(".dst-formats-header");for(const e of t){const t=document.createElement("div");t.addEventListener("click",(()=>{i.querySelectorAll(".selected").forEach((e=>e.classList.remove("selected"))),t.classList.add("selected")})),t.setAttribute("data-format",e.name),t.innerHTML=`<div>${e.name}</div>`,i.appendChild(t)}a.firstElementChild&&a.firstElementChild.classList.add("selected"),i.firstElementChild&&i.firstElementChild.classList.add("selected"),initialization=!1})();{const e=$1(".src-drop-area");function preventDefault(e){e.preventDefault(),e.stopPropagation()}function highlightDropArea(t){e.classList.add("highlight")}function unhighlightDropArea(t){e.classList.remove("highlight")}function handleDrop(e){unhighlightDropArea(e),preventDefault(e);const t=e.dataTransfer.files;for(const e of t)filePenis(e)}e.on("dragenter",highlightDropArea),e.on("dragleave",unhighlightDropArea),e.on("dragover",preventDefault),e.on("drop",handleDrop)}function downloadBlob(e,t){const a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=t,a.click(),URL.revokeObjectURL(a.href)}async function filePenis(e){initialization&&await initialization;const t=await new Promise(((t,a)=>{const i=new FileReader;i.onload=e=>t(e.target.result),i.onerror=a,i.readAsArrayBuffer(e)})),a=await deduceFormats(t,{mimeType:e.type,mustSupportDecoding:!0});if(0==a.length)throw"Unknown format";const i=a[0],o=await i.decode(t),n=$1(".dst-formats-header .selected").dataset.format,r=Object.values(formats).find((e=>e.name==n));console.log(e);downloadBlob(await r.encode(o),`${e.name.replace(/\.[^.]*$/,"")}.${r.ext[0]}`)}